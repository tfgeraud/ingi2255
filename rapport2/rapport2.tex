\documentclass[12pt]{article}
\usepackage{zed-csp}%from
\usepackage[utf8]{inputenc}

\begin{document}

\title{Schémas Z et tests BlackBox}
\author{Groupe 2}
\date{\today}
\maketitle


\section{Types donnés}
Les spécifications Z s'appuient sur les types suivants:
\begin{zed}
AMBULANCE \\
COORDINATES \\
INCIDENT \\
NAME \\
DATE \\
STATUS  \\
KIND \\
LOCALISATION \\
BOOLEAN \\
MESSAGE  \\
\end{zed}

Pour les types dont il est intéressant de spécifier les valeurs possibles, voici à quoi elles correspondent:
\begin{syntax}
STATUS ::= 'FREE' | 'CHOSEN' | 'MOBILIZED' \\
KIND ::= 'NORMAL' | 'MEDICALIZED' \\
BOOLEAN ::= 'TRUE'  | 'FALSE' \\
MESSAGE ::= 'OK' | 'UnknownIncident' | 'IncidentAlreadyAttributed' | 'NoGoodAmbulance'
\end{syntax}

% TODO : Expliciter chacun des types ci-après en expliquant ce que chacun représente
L'explication pour chacun des types est fournie dans le tableau \ref{tab:typedefinition}.
\begin{table}[htdp]\begin{center}\begin{tabular}{|c|c|}
	\hline 
	\textit{Type} & \textit{Définition} \\
	\hline
	AMBULANCE & L'ensemble des ambulances physiques possibles. \\
	\hline
	COORDINATES & L'ensemble des coordonnées géographiques possibles (latitude, longitude). \\
	\hline
	INCIDENT & L'ensemble des incidents possibles. \\
	\hline
	NAME & L'ensemble des noms possibles. \\ % TODO : Inutile puisque inutilisé.  A enlever?!
	\hline
	DATE & L'ensemble des dates possibles. \\ % TODO : Inutile puisque inutilisé.  A enlever?!
	\hline
	STATUS & L'ensemble des statuts possibles pour une ambulance. \\
	\hline
	KIND & L'ensemble des types d'ambulance possibles. \\
	\hline
	LOCALISATION & L'ensemble des localisations possibles (rue, numéro, adresse, etc.). \\ % TODO : Inutile puisque inutilisé.  A enlever?!
	\hline
	BOOLEAN & L'ensemble des booléens. \\
	\hline
	MESSAGE & L'ensemble des messages possibles. \\
	\hline
\end{tabular}
\caption{Définition des types donnés}\end{center}\label{tab:typedefinition}\end{table}


\section{Schémas Types}
\begin{schema}{AmbulanceInformation}
 	registered\_ambulance : \power AMBULANCE \\
	\newline \\
 	position\_ambulance : AMBULANCE \pinj COORDINATES \\
 	kind\_ambulance : AMBULANCE \pfun KIND \\
  \where
  	\dom position\_ambulance = \dom kind\_ambulance = registered\_ambulance
\end{schema}

\begin{schema}{IncidentInformation}
	registered\_incident : \power INCIDENT \\
	\newline \\
	victimAge\_incident : INCIDENT \pfun \nat \\ % TODO Trouver le truc Z correspondant au nombre naturel
	victimPregnant\_incident : INCIDENT \pfun BOOLEAN \\
	localisation\_incident : INCIDENT \pfun LOCALISATION \\
	description\_incident : INCIDENT \pfun DESCRIPTION \\
	\newline \\
	position\_incident : INCIDENT \pfun POSITION \\
	ambulanceKindNeeded\_incident : INCIDENT \pfun KIND \\
  \where
  	\dom victimAge\_incident = \dom victimPregnant\_incident =\\
	 \dom localisation\_incident = \dom description\_incident =\\
	 registered\_incident \\
	 \newline \\
	 \dom position\_incident = \dom ambulanceKindNeeded\_incident \\
	 \dom position\_incident \subseteq registered\_incident \\
	 \dom ambulanceKindNeeded\_incident  \subseteq registered\_incident \\ % Redondant répété pour la clarté
\end{schema}

\begin{schema}{Mobilization}
	AmbulanceInformation \\
	IncidentInformation \\
	\newline \\
	status\_ambulance : AMBULANCE \pfun STATUS \\
	choice\_mobilization : AMBULANCE \pinj INCIDENT \\
	mob\_mobilization : AMBULANCE \pinj INCIDENT \\
  \where
  	\dom choice\_mobilization \subseteq registered\_ambulance \\
	\dom mob\_mobilization \subseteq registered\_ambulance \\
	\dom mob\_mobilization  \subseteq \dom choice\_mobilization \\
	\newline \\
	\ran choice\_mobilization \subseteq registered\_incident \\
	\ran mob\_mobilization \subseteq registered\_incident \\
	\ran mob\_mobilization  \subseteq \ran choice\_mobilization \\
	\newline \\
	\forall a: AMBULANCE @ 
			(status\_ambulance(a) = 'FREE') \equiv \\
	                        ( a \notin \dom choice\_mobilization \land a \notin \dom mob\_mobilization) \\
	                   \land
	                   (status\_ambulance(a) = 'CHOSEN') \equiv \\
	                        ( a \in \dom choice\_mobilization \land a \notin \dom mob\_mobilization) \\
	                     \land
	                   (status\_ambulance(a) = 'MOBILIZED') \equiv \\
	                        ( a \in \dom choice\_mobilization \land a \in \dom mob\_mobilization) \\
  	
\end{schema}

\section{Opérations}

\subsection{ChooseBestAmbulance}

L'opération CooseBestAmbulance peut être définie comme suit :

	$ChooseBestAmbulance = ChooseBestAmbulanceOK \land Success \lor
	 UnknownIncident \lor IncidentAlreadyAttributed \lor NoGoodAmbulance$

\subsubsection{ChooseBestAmbulanceOK}

Pour cette première opération, nous faisons comme hypothèse qu'il existe une
fonction $distance : (COORDINATES, COORDINATES) \rightarrow \nat$ qui renvoie la 
distance entre deux coordonnées.

\begin{schema}{ChooseBestAmbulanceOK}
	\Delta Mobilization 	\\
	\Xi AmubulanceInfo		\\
	\Xi AmbulanceInfo		\\
	\newline				\\
	incident? : INCIDENT	\\
	\newline				\\
	ambulance! : AMBULANCE	\\
  \where
  	incident? \in registered\_incident \\
  	incident? \notin \ran choice\_mobilization \\
  	\exists a: AMBULANCE @ status\_ambulance = 'FREE' \land \\
  	 kind\_ambulance(a) = ambulanceKindNeeded\_incident(incident?) \\
  	\newline \\
  	\forall a: AMBULANCE @ (status\_ambulance(a) = 'FREE' \land \\
  	 kind\_ambulance(a) = ambulanceKindNeeded\_incident(incident?) \land \\
  	 distance(position\_ambulance(a), position\_incident(incident?))) \\
  	 \geq distance(position\_ambulance(ambulance!), \\
  	 position\_incident(incident?))\\
  	\newline \\
  	choice\_mobilization' = choice\_mobilization \oplus \{ ambulance! \mapsto incident? \} \\
  	mob\_mobilization' = mob\_mobilization
\end{schema}

\subsubsection{Success}

\begin{schema}{Success}
	message! : REPORT	\\
  \where				
	message! = 'OK'		\\
\end{schema}

\subsubsection{UnknownIncident}

\begin{schema}{UnknownIncident}
	\Xi IncidentInfo		\\
	\newline				\\
	incident? : INCIDENT	\\
	\newline				\\
	ambulance! : AMBULANCE	\\
	message! : REPORT		\\
  \where  
	incident? \notin registered\_incident \\
	message! = 'UnknownIncident'
\end{schema}

\subsubsection{IncidentAlreadyAttributed}

\begin{schema}{IncidentAlreadyAttributed}
	\Xi IncidentInfo		\\
	\Xi Mobilization		\\
	\newline				\\
	incident? : INCIDENT	\\
	\newline				\\
	ambulance! : AMBULANCE	\\
	message! : REPORT		\\
  \where
  	incident? \in registered\_incident \\
  	incident? \in \ran choice\_mobilization \\
  	\newline \\
  	message! = 'IncidentAlreadyAttributed'
\end{schema}

\subsubsection{NoGoodAmbulance}

\begin{schema}{NoGoodAmbulance}
	\Xi Mobilization		\\
	\newline				\\
	incident? : INCIDENT	\\
	\newline				\\
	ambulance! : AMBULANCE	\\
	message! : REPORT		\\
  \where
	incident? \in registered\_incident \\
	incident? \notin \ran choice\_mobilization \\
	\not \exists a : AMBULANCE @ status\_ambulance(a) = 'FREE' \land \\
	 kind\_ambulance(a) = ambulanceKindNeeded\_incident(incident?) \\
	\newline \\
	message! = 'NoGoodAmbulance'
\end{schema}

\subsection{ListUnattributedIncidents}

\begin{schema}{ListUnattributedIncidents}
	\Xi Mobilization		\\
	\newline				\\
	incidents! : \power INCIDENT \\
  \where
	incidents! \subseteq registered\_incident \\
	incidents! = \{ i : INCIDENT | i \notin \ran choice\_mobilization\}
\end{schema}

\section{Tests Boîte Noire}



% TODO :remove this section
\section{Exemples Z}
Cette section est laissée ici pour faciliter le démarrage de tout le monde avec Z en latex.  Évidemment\\ elle devra être retirée du rapport final.

Exemples de types donnés:
\begin{zed}
[PRODUCT\\ COIN]
\end{zed}


Exemple de schéma d'état
\begin{schema}{ShemaName}
  inventory : \bag PRODUCT\\
  price : PRODUCT \pfun \nat\\
  float : \bag COIN\\
  entered : \bag COIN\\
  accept : \power COIN
  \where
  \dom inventory \subseteq \dom price\\
  \dom float \subseteq accepted\\
  \dom entered \subseteq accepted
\end{schema}

Exemple d'opération
\begin{schema}{AcceptCoin}
\Delta Money\\
newCoin? : COIN
\where
newCoin? \notin accept\\
float' = float\\
entered' = entered\\
accept' = accept \cup \{newCoin?\}
\end{schema}


\end{document}
